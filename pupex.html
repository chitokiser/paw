<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="PAW DAO · PUP Exchange"/>
  <meta name="author" content="PAW DAO"/>
  <link rel="shortcut icon" href="../images/logo.png"/>

  <!-- Bootstrap 5 (CSS & JS) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- Libraries (ethers v5; axios). topinfo.js는 v5/v6 호환 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.2.0/ethers.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <title>PAW DAO · PUP Exchange</title>

  <style>
    :root{
      /* Dark + Glass UI */
      --bg:#0b0d14;
      --text:#e9eefc;
      --muted:#a9b1c7;
      --border:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.06);
      --glass-2:rgba(255,255,255,.08);
      --grad:linear-gradient(135deg,#7c3aed 0%,#2563eb 100%);
      --radius:16px;
    }
    html,body{ background:var(--bg); color:var(--text); min-height:100%; }
    a, a:visited{ color:#cbd5ff; }

    /* Glass card */
    .glass-card{
      background:var(--glass);
      border:1px solid var(--border);
      border-radius:var(--radius);
      backdrop-filter:saturate(140%) blur(8px);
      -webkit-backdrop-filter:saturate(140%) blur(8px);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .card-header{ background:transparent; border-bottom:1px solid var(--border); }
    .card-body p, .small-text, .list-group-item{ color:var(--muted); }
    .muted{ color:var(--muted) !important; }

    /* Layout */
    .container-narrow{ max-width: 1040px; margin: 0 auto; padding: 12px; }

    /* Buttons */
    .btn-primary{
      background-image:var(--grad); border:0;
    }
    .btn-outline-secondary, .btn-outline-success, .btn-outline-danger{
      border-color:var(--border); color:var(--text);
    }
    .btn-outline-secondary:hover, .btn-outline-success:hover, .btn-outline-danger:hover{
      background:var(--glass-2);
    }
    .btn:focus{ box-shadow:0 0 0 .2rem rgba(124,58,237,.28); }

    /* Inputs */
    .form-control, .form-control-lg{
      background:rgba(255,255,255,.04); color:var(--text); border:1px solid var(--border);
    }
    .form-control::placeholder{ color:#b6bfd6; opacity:.8; }

    /* Section spacing on mobile */
    @media (max-width: 576px){
      .card-body{ padding: 1rem !important; }
    }
  </style>
</head>
<body>
  <!-- Header placeholder (dashboard.html will be injected here) -->
  <div id="menu-placeholder"></div>

  <main class="container-narrow" aria-live="polite">
    <!-- Intro / Policy -->
    <section class="glass-card mb-3">
      <div class="card-header d-flex align-items-center justify-content-between">
        <h5 class="mb-0">PUP (PAW Utility Token)</h5>
        <span class="badge text-bg-light">opBNB</span>
      </div>
      <div class="card-body">
        <ul class="mb-2" style="padding-left: 1rem;">
          <li class="list-group-item">PAW is distributed weekly in proportion to the amount of PUP held.</li>
          <li class="list-group-item">You can sell PUP to smart contracts if you are at least <strong>Level 6</strong> and <strong>tradable status = 3</strong>.</li>
        </ul>
      </div>
    </section>

    <!-- Chart -->
    <section class="glass-card mb-3">
      <div class="card-header">
        <div class="d-flex align-items-center justify-content-between">
          <h6 class="mb-0">PUP price change</h6>
          <button type="button" class="btn btn-sm btn-outline-secondary">
            <span id="calD">-</span>
          </button>
        </div>
      </div>
      <div class="card-body">
        <div id="myChart" class="w-100" style="height: 360px;"></div>
      </div>
    </section>

    <!-- Basic Info -->
    <section class="glass-card mb-3">
      <div class="card-header">
        <h6 class="mb-0">PUP Basic Information</h6>
      </div>
      <div class="card-body">
        <ul class="mb-2" style="padding-left: 1rem;">
          <li class="list-group-item">Tradable Status: <span id="Act">-</span></li>
          <p class="small-text">Status Description: 1 = Buy, 2 = Distribute, 3 = Sell</p>

          <li class="list-group-item">Smart Contract PAW Balance: <span id="Cyabal">-</span> PAW</li>
          <li class="list-group-item">Smart Contract PUP Balance: <span id="Mutbal">-</span> PUP</li>
          <li class="list-group-item">PUP Distribution: <span id="Mutcir">-</span> PUP</li>
          <li class="list-group-item">1 PUP Price: <span id="Mprice">-</span> PAW</li>
          <li class="list-group-item">1 PUP Dividend (Level 10): <span id="Mallow">-</span> PAW</li>
          <li class="list-group-item">You must have purchased at least 1 PUP on this exchange at least once to receive dividends.</li>
          <li class="list-group-item">Members with more than 5,000 PUP can receive dividends weekly
            <a class="btn btn-light ms-2" href="./memberjoin.html" role="button">My Page &raquo;</a>
          </li>
        </ul>

        <div class="d-flex flex-wrap gap-2 mb-2">
          <button class="btn btn-outline-success" type="button" onclick="cutmemberLogin()">My Status (Wallet Link)</button>
          <button class="btn btn-outline-success" type="button" onclick="Allow()">Receive Dividend</button>
        </div>

        <ul class="mb-0" style="padding-left: 1rem;">
          <li class="list-group-item">My PUP: <span id="myCut">-</span> PUP</li>
          <li class="list-group-item">My PUP Market Cap: <span id="myCutvalue">-</span> PAW</li>
          <li class="list-group-item">This Dividend Amount: <span id="myAllow">-</span> PAW</li>
          <li class="list-group-item">Time Left Until Next Dividend: <span id="epsLeftTime">-</span></li>
        </ul>
      </div>
    </section>

    <!-- Exchange -->
    <section class="glass-card mb-4">
      <div class="card-header">
        <h6 class="mb-0">PUP Exchange</h6>
      </div>
      <div class="card-body p-4">
        <div class="alert alert-warning text-center mb-4" role="alert">
          Available for purchase at <strong>Level 1+</strong>
        </div>

        <div class="input-group mb-4">
          <input type="text" id="buyAmount" class="form-control form-control-lg" placeholder="Enter PUP amount (no decimals)" aria-label="PUP amount to buy">
          <button class="btn btn-primary px-4 fw-bold" type="button" onclick="Buymut()">Buy PUP</button>
        </div>

        <div class="alert alert-danger text-center mb-4" role="alert">
          You can sell PUP only if you are <strong>Level 6+</strong> and tradable status is <strong>3</strong>.
        </div>

        <div class="input-group">
          <input type="text" id="sellAmount" class="form-control form-control-lg" placeholder="Enter PUP amount (no decimals)" aria-label="PUP amount to sell">
          <button class="btn btn-outline-danger px-4 fw-bold" type="button" onclick="Sellmut()">Sell PUP</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <div id="footer" class="container-narrow my-4 small muted"></div>

  <!-- Charts & page scripts (after content) -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" crossorigin="anonymous"></script>
  <script src="../src/dashboard.js"></script>
  <script src="../src/PupBank.js"></script>

  <script>
    // ---------- Safe include: header (dashboard.html) ----------
    async function safeFetchText(url){
      try{
        const res = await fetch(url, { cache: "no-cache" });
        if (!res.ok) throw new Error(String(res.status));
        const ct = res.headers.get("content-type") || "";
        if (!ct.includes("text/html")) throw new Error("Not HTML");
        return await res.text();
      }catch(e){
        console.warn("[include] failed:", url, e?.message || e);
        return null;
      }
    }

    async function loadHeader(){
      const html = await safeFetchText("dashboard.html");
      if (!html) return;
      const host = document.getElementById("menu-placeholder");
      if (host) host.innerHTML = html;

      // Ensure TopInfo is loaded and run topData (works even if topinfo.js is elsewhere)
      const callTopDataOnce = () => {
        try{
          if (window.TopInfo && typeof window.TopInfo.topData === "function"){ window.TopInfo.topData(); return true; }
          if (typeof window.topData === "function"){ window.topData(); return true; } // legacy
        }catch(e){
          console.warn("[page] topData() failed:", e?.message || e);
        }
        return false;
      };

      if (!callTopDataOnce()){
        let tries = 0, maxTries = 20, interval = 300;
        const timer = setInterval(()=>{
          tries++;
          if (callTopDataOnce() || tries >= maxTries) clearInterval(timer);
        }, interval);
      }
    }

    // ---------- Safe include: footer ----------
    async function loadFooter(){
      const html = await safeFetchText("../footer.html");
      if (!html) return;
      const host = document.getElementById("footer");
      if (host) host.innerHTML = html;
    }

    // ---------- Boot ----------
    window.addEventListener("load", async ()=>{
      await loadHeader();
      await loadFooter();

      // Optional: Feather icons
      try { feather && feather.replace(); } catch {}
    });
  </script>
</body>
</html>
