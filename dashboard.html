<!-- dashboard.html (dark-glass, mobile-first, slim) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PawDAO ¬∑ Dashboard</title>

  <!-- Bootstrap (CSS/JS) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
  <!-- (optional) tiny glyphs
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"> -->

  <style>
    :root{
      /* Dark + glass */
      --bg: #0b0d14;
      --text: #e9eefc;
      --muted: #a9b1c7;
      --border: rgba(255,255,255,.12);
      --glass: rgba(255,255,255,.06);
      --glass-2: rgba(255,255,255,.08);
      --grad: linear-gradient(135deg,#7c3aed 0%,#2563eb 100%);
      --radius: 14px;

      /* Nav */
      --nav-bg: rgba(15,18,27,.7);
      --nav-text: var(--text);
    }

    html, body{
      background: var(--bg);
      color: var(--text);
    }

    /* Slim navbar (glass) */
    .nav-slim{
      background: var(--nav-bg);
      color: var(--nav-text);
      border-bottom: 1px solid var(--border);
      padding: .4rem .75rem;
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
    }
    .nav-slim .navbar-brand{
      color: var(--nav-text);
      text-decoration: none;
      display: flex; align-items: center;
    }
    .nav-slim .navbar-brand img{
      width: 36px; height: 36px; border-radius: 10px; border:1px solid var(--border);
    }
    .nav-slim .brand-text{
      font-weight: 700; margin-left: .5rem; letter-spacing: .2px; font-size: 15px;
    }
    .nav-slim .nav-link{
      color: var(--nav-text);
      padding: .45rem .6rem; border-radius: 10px; font-weight: 600; font-size: 14px;
    }
    .nav-slim .nav-link:hover{ background: var(--glass); }

    .navbar-toggler{
      border: 1px solid var(--border) !important;
    }
    .navbar-toggler-icon{
      filter: invert(100%);
    }

    /* Content wrapper */
    .container-narrow{ max-width: 1040px; margin: 0 auto; padding: .75rem; }

    /* Metric chips (glass cards) */
    .metric-row{
      display: grid; gap: .6rem;
      grid-template-columns: 1fr 1fr;
    }
    @media (min-width: 768px){
      .metric-row{ grid-template-columns: repeat(4, 1fr); }
    }
    .metric-chip{
      background: var(--glass-2);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: .8rem .85rem;
      display: grid; grid-template-columns: 1fr auto; align-items: center;
      min-height: 70px;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .metric-chip .label{
      color: var(--muted); font-size: 12px; margin-bottom: .15rem;
    }
    .metric-chip .value{
      font-size: 17px; font-weight: 800; line-height: 1.1;
    }
    .metric-chip .unit{ font-size: 12px; color: var(--muted); margin-left: .25rem; }
    .metric-chip .glyph{
      color: #d8c9ff; font-size: 18px; opacity: .9;
      border: 1px solid var(--border); padding:.3rem .45rem; border-radius: 10px;
      background: rgba(124,58,237,.12);
    }

    /* Ghost button (wallet) */
    .btn-ghost{
      border: 1px solid var(--border);
      background: var(--glass);
      color: var(--text);
      border-radius: 12px;
      padding: .45rem .65rem;
      font-weight: 700;
      transition: .2s ease;
    }
    .btn-ghost:hover{ background: var(--glass-2); }

    .dropdown-menu{
      border-radius: 12px; border-color: var(--border); background: #0e1220;
      overflow: hidden;
    }
    .dropdown-item{ padding: .55rem .75rem; font-weight: 600; color: var(--text); }
    .dropdown-item:hover{ background: rgba(124,58,237,.18); color:#ffffff; }

    /* Tiny helpers */
    .muted{ color: var(--muted) !important; }

    /* Tap targets on very small devices */
    @media (max-width: 360px){
      .nav-slim .brand-text{ display: none; }
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-md nav-slim">
    <div class="container-fluid px-2">
      <a class="navbar-brand" href="../index.html">
        <img src="/images/logo.png" alt="Logo">
        <span class="brand-text">PawDAO</span>
      </a>

      <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navSlimCollapse"
              aria-controls="navSlimCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse mt-2 mt-md-0" id="navSlimCollapse">
        <ul class="navbar-nav me-auto align-items-md-center">
          <li class="nav-item"><a class="nav-link" href="../mypage.html">My page</a></li>
          <li class="nav-item"><a class="nav-link" href="../p2e/WithPuppy.html">PuppyGame</a></li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
              Token Exchange
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="../pawex.html">PAW Token</a></li>
              <li><a class="dropdown-item" href="../pupex.html">PUP Token</a></li>
            </ul>
          </li>

          <li class="nav-item"><a class="nav-link" href="../PuppyMarket.html">PuppyMarket</a></li>
        </ul>

        <div class="d-flex align-items-center gap-2">
          <div class="dropdown">
            <button class="btn btn-ghost dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              Connect Wallet
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="../memberjoin.html">Sign up</a></li>
              <li><a class="dropdown-item" href="#" id="btnAddPAW">Add PAW</a></li>
              <li><a class="dropdown-item" href="#" id="btnAddPUP">Add PUP</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- METRICS -->
  <section class="container-narrow mt-2">
    <div class="metric-row">
      <!-- Holder -->
      <div class="metric-chip">
        <div>
          <div class="label">Holder</div>
          <div class="value"><span id="Sum">-</span></div>
        </div>
        <div class="text-end">
          <span class="glyph">üë•</span>
        </div>
      </div>

      <!-- 1 BNB = $ -->
      <div class="metric-chip">
        <div>
          <div class="label">1 BNB</div>
          <div class="value">$<span id="bPrice">-</span></div>
        </div>
        <div class="text-end">
          <span class="glyph">üíµ</span>
        </div>
      </div>

      <!-- 1 PAW = $1 -->
      <div class="metric-chip">
        <div>
          <div class="label">1 PAW</div>
          <div class="value">$1<span class="unit"></span></div>
        </div>
        <div class="text-end">
          <span class="glyph">‚ö°</span>
        </div>
      </div>

      <!-- 1 PUP in BNB -->
      <div class="metric-chip">
        <div>
          <div class="label">1 PUP</div>
          <div class="value"><span id="cPrice2">-</span><span class="unit"> BNB</span></div>
        </div>
        <div class="text-end">
          <span class="glyph">ü™ô</span>
        </div>
      </div>
    </div>

    <!-- Secondary row -->
    <div class="metric-row mt-2">
      <div class="metric-chip">
        <div>
          <div class="label">BNB TVL</div>
          <div class="value"><span id="Tvl">-</span><span class="unit"> BNB</span></div>
        </div>
        <div class="text-end">
          <span class="glyph">üè¶</span>
        </div>
      </div>
      <!-- Layout fillers (hidden on mobile via grid cols) -->
      <div class="metric-chip d-none d-md-grid"></div>
      <div class="metric-chip d-none d-md-grid"></div>
      <div class="metric-chip d-none d-md-grid"></div>
    </div>
  </section>

  <script>
    // ---- Safe TopInfo trigger (works with dynamic includes) ----
    (function(){
      function callTopDataOnce(){
        try{
          if (window.TopInfo && typeof window.TopInfo.topData === "function"){
            window.TopInfo.topData();
            return true;
          }
          if (typeof window.topData === "function"){ // backward compatibility
            window.topData();
            return true;
          }
        }catch(e){
          console.warn("[dashboard] topData() failed:", e?.message || e);
        }
        return false;
      }

      // Try immediately after DOM is ready
      if (document.readyState === "loading"){
        document.addEventListener("DOMContentLoaded", tryCallWithRetry, { once: true });
      } else {
        tryCallWithRetry();
      }

      // Retry a few times in case topinfo.js loads after this HTML is injected
      function tryCallWithRetry(){
        if (callTopDataOnce()) return;
        let tries = 0;
        const maxTries = 20;     // ~6 seconds total
        const interval = 300;    // ms
        const timer = setInterval(()=>{
          tries++;
          if (callTopDataOnce() || tries >= maxTries){
            clearInterval(timer);
          }
        }, interval);
      }
    })();

    // ---- Token buttons delegate to TopInfo if available ----
    (function(){
      function bind(id, fn){
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("click", (e)=>{
          e.preventDefault();
          const ns = window.TopInfo;
          if (ns && typeof ns[fn] === "function"){ ns[fn](); }
          else if (typeof window[fn] === "function"){ window[fn](); } // legacy globals
          else { alert("Wallet helper is not available on this page."); }
        });
      }
      bind("btnAddPAW", "addTokenPAW");
      bind("btnAddPUP", "addTokenPUP");
    })();
  </script>
</body>
</html>
