<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puppy Hunt Game</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; background: #f2f2f2; }
    #puppy-container { margin-top: 20px; }
    .puppy { display: none; margin: 20px auto; }
    .puppy img { width: 200px; border-radius: 10px; }
    #getBtn { padding: 10px 20px; font-size: 16px; background: #ff7f50; color: #fff; border: none; border-radius: 5px; display: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>ğŸ¾ ìœ„ì¹˜ê¸°ë°˜ ê°•ì•„ì§€ ì°¾ê¸° ê²Œì„</h2>
  <p>ê·¼ì²˜ ê°•ì•„ì§€ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</p>
  <button onclick="getLocation()">ë‚´ ìœ„ì¹˜ í™•ì¸</button>
  <div id="puppy-container"></div>
  <button id="getBtn" onclick="getPuppy()">ê°•ì•„ì§€ GET!</button>

  <script>
    // === ê´€ë¦¬ì ì§€ì • ê°•ì•„ì§€ ë°ì´í„° (ì„œë²„/DB ëŒ€ì²´ìš©) ===
    const puppyData = [
      { id: 1, name: "Puppy 1", lat: 37.5665, lon: 126.9780, img: "https://place-puppy.com/200x200" },
      { id: 2, name: "Puppy 2", lat: 37.5651, lon: 126.9895, img: "https://place-puppy.com/201x201" }
    ];

    let foundPuppy = null; // ì‚¬ìš©ìê°€ ê·¼ì²˜ì— ìˆì„ ë•Œ í‘œì‹œí•  ê°•ì•„ì§€

    // === ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (Haversine Formula) ===
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„(m)
      const toRad = (deg) => deg * Math.PI / 180;
      const Ï†1 = toRad(lat1), Ï†2 = toRad(lat2);
      const Î”Ï† = toRad(lat2 - lat1);
      const Î”Î» = toRad(lon2 - lon1);

      const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                Math.cos(Ï†1) * Math.cos(Ï†2) *
                Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c; // meters
    }

    // === ì‚¬ìš©ì ìœ„ì¹˜ í™•ì¸ ===
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(checkNearbyPuppy, showError, { enableHighAccuracy: true });
      } else {
        alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
      }
    }

    // === ê°•ì•„ì§€ ê·¼ì ‘ ì—¬ë¶€ í™•ì¸ ===
    function checkNearbyPuppy(position) {
      const userLat = position.coords.latitude;
      const userLon = position.coords.longitude;

      // 50m ì´ë‚´ ê°•ì•„ì§€ íƒìƒ‰
      foundPuppy = puppyData.find(p => getDistance(userLat, userLon, p.lat, p.lon) <= 50);

      const container = document.getElementById("puppy-container");
      container.innerHTML = "";

      if (foundPuppy) {
        const div = document.createElement("div");
        div.classList.add("puppy");
        div.style.display = "block";
        div.innerHTML = `<h3>${foundPuppy.name} ë°œê²¬!</h3><img src="${foundPuppy.img}" alt="Puppy">`;
        container.appendChild(div);

        document.getElementById("getBtn").style.display = "inline-block";
      } else {
        container.innerHTML = "<p>ê·¼ì²˜ì— ê°•ì•„ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ë” ê°€ê¹Œì´ ì´ë™í•˜ì„¸ìš”.</p>";
        document.getElementById("getBtn").style.display = "none";
      }
    }

    // === ê°•ì•„ì§€ GET ì²˜ë¦¬ ===
    function getPuppy() {
      if (!foundPuppy) return;
      alert(`${foundPuppy.name} ì„(ë¥¼) GETí–ˆìŠµë‹ˆë‹¤!`);
      document.getElementById("getBtn").style.display = "none";
    }

    // === ì—ëŸ¬ ì²˜ë¦¬ ===
    function showError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED: alert("ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤."); break;
        case error.POSITION_UNAVAILABLE: alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); break;
        case error.TIMEOUT: alert("ìœ„ì¹˜ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤."); break;
        default: alert("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }
  </script>
</body>
</html>
