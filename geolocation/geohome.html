<!-- geohome.html (Dark-Glass · Mobile-first · Wallet-only · 2025-08) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="theme-color" content="#0b0d14"/>
  <title>GeoHunt · Home</title>
  <link rel="shortcut icon" href="../images/logo.png"/>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- Libraries (ethers v5; axios optional) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>

  <style>
    :root{
      --bg:#0b0d14; --text:#e9eefc; --muted:#a9b1c7;
      --border:rgba(255,255,255,.12);
      --card:rgba(255,255,255,.06); --card-2:rgba(255,255,255,.08);
      --grad:linear-gradient(135deg,#7c3aed 0%,#2563eb 100%);
      --radius:18px; --radius-sm:14px;
      --pad:16px; --pad-sm:12px;
      --shadow:0 10px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{min-height:100%; background:var(--bg); color:var(--text)}
    body{
      display:flex; justify-content:center;
      padding:16px;
      padding-left:calc(env(safe-area-inset-left,0) + 12px);
      padding-right:calc(env(safe-area-inset-right,0) + 12px);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;
    }
    .wrap{width:min(1100px,100%); margin:auto}
    .glass{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    @supports ((-webkit-backdrop-filter: blur(6px)) or (backdrop-filter: blur(6px))) {
      .glass{
        -webkit-backdrop-filter: blur(8px) saturate(140%);
        backdrop-filter: blur(8px) saturate(140%);
      }
    }
    .panel{padding:var(--pad)}
    .title{font-weight:800}
    .muted{color:var(--muted)!important}
    .badge-soft{
      display:inline-block; padding:4px 10px; border-radius:999px; font-weight:800; font-size:12px;
      border:1px solid var(--border); background:var(--card-2)
    }

    .metric{
      background:var(--card-2); border:1px solid var(--border); border-radius:var(--radius-sm); padding:12px;
      display:flex; flex-direction:column; gap:4px; height:100%
    }
    .metric .label{font-size:12px; color:var(--muted)}
    .metric .value{font-size:clamp(22px,6vw,36px); font-weight:800; line-height:1.05}

    /* Address line */
    #addr{
      max-width:70vw; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; display:inline-block; vertical-align:bottom;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; font-size:14px
    }
    @media (max-width:480px){
      #addr{white-space:normal; overflow-wrap:anywhere; word-break:break-all; max-width:100%}
      .panel{padding:var(--pad-sm)}
    }
    .g-gap > [class*="col-"]{margin-bottom:8px}
    @media (min-width:992px){ .g-gap > [class*="col-"]{margin-bottom:0} }

    /* Sticky action bar */
    .actionbar{ position:sticky; bottom:0; z-index:10; margin-top:12px;
      background:linear-gradient(180deg, rgba(11,13,20,0) 0%, rgba(11,13,20,.75) 40%, rgba(11,13,20,1) 100%);
      padding-top:8px;
    }
    .actionbar-inner{ display:flex; gap:8px; align-items:center; justify-content:space-between }
    .btn-grad{background:var(--grad); color:#fff; border:0; border-radius:14px; padding:12px 16px; font-weight:800; flex:1}
    .btn:focus{box-shadow:0 0 0 .24rem rgba(124,58,237,.28)}

    /* Embedded cards */
    .embed-card .title{font-size:16px}
    .embed-card #puppy-card > .puppy-card,
    .embed-card #reqboard > .rb-wrap{
      border-radius:14px; border:1px solid var(--border); background:var(--card-2);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <header class="mb-3 text-center">
      <a href="../p2e/WithPuppy.html" aria-label="Open WithPuppy">
        <img src="../images/logo.png" width="44" height="44" alt="logo" class="rounded-3" style="border:1px solid var(--border)" loading="lazy"/>
      </a>
      <h1 class="h4 mt-2 mb-1">GeoHunt Home</h1>
      <div id="modeBadge" class="badge-soft">Mode: Wallet</div>
    </header>

    <div class="row g-3 g-gap">
      <!-- Left: Wallet only -->
      <div class="col-12 col-lg-5">
        <section class="glass panel">
          <div class="d-flex align-items-center justify-content-between">
            <h2 class="title h5 mb-0">Wallet</h2>
            <span class="muted small">Connect to play & save</span>
          </div>

          <div id="walletBox" class="glass panel mt-2" style="display:block">
            <div class="d-flex align-items-center justify-content-between gap-2">
              <div class="flex-grow-1">
                <div class="muted small">Wallet Address</div>
                <div id="addr" class="fw-bold">-</div>
              </div>
              <button id="btnConnect" class="btn btn-sm btn-grad" style="white-space:nowrap;">Connect</button>
            </div>
            <hr/>
            <div class="row g-2">
              <div class="col-6">
                <div class="metric">
                  <div class="label">Member Level</div>
                  <div id="levelView" class="value">-</div>
                </div>
              </div>
              <div class="col-6">
                <div class="metric">
                  <div class="label">Gate</div>
                  <div id="levelGate" class="value" style="font-size:clamp(16px,4.5vw,22px)">—</div>
                </div>
              </div>
            </div>
          </div>

          <p class="mt-3 muted small mb-0">
            Only level 1+ can play and claim. If you are new, please <a href="../memberjoin.html">sign up</a>.
          </p>
        </section>
      </div>

      <!-- Right: Progress / Claim -->
      <div class="col-12 col-lg-7">
        <section class="glass panel">
          <h2 class="title h5">Today</h2>

          <div class="row g-2">
            <div class="col-6">
              <div class="metric">
                <div class="label">CP Today</div>
                <div class="value" id="cpToday">0</div>
                <div class="label">(Sum of walk / hunt / shop)</div>
              </div>
            </div>
            <div class="col-6">
              <div class="metric">
                <div class="label">On-chain Claim</div>
                <div id="chainStatus" class="fw-bold" style="font-size:clamp(12px,3.5vw,14px)">Req: Level 1 & 5000+ CP today</div>
                <button id="btnSync" class="btn btn-sm btn-grad mt-2 w-100" disabled>Claim to chain</button>
                <div class="label mt-1">Activates when the condition is met.</div>
              </div>
            </div>
          </div>

          <!-- Sticky reach bar -->
          <div class="actionbar">
            <div class="actionbar-inner">
              <button id="btnStartGame" class="btn btn-grad">Start Game (Wallet)</button>
            </div>
          </div>
        </section>

        <!-- Puppy Stats Card -->
        <section class="glass panel embed-card mt-2">
          <div class="d-flex align-items-center justify-content-between">
            <h3 class="title mb-0">Puppy On-chain Stats</h3>
            <span class="muted small">Auto-mapped to game</span>
          </div>
          <div id="puppy-card" class="mt-2"></div>
        </section>

        <!-- Requirements Board -->
        <section class="glass panel embed-card mt-2">
          <div class="d-flex align-items-center justify-content-between">
            <h3 class="title mb-0">User Requirements Board</h3>
            <span class="muted small">Level 1+ can post</span>
          </div>
          <div id="reqboard" class="mt-2"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- Modules -->
   <script type="module" src="./js/firebase.js"></script>
   <script type="module" src="../geolocation/js/board/rb_api.js"></script> <!-- (직접 로드 안해도 됨: ui가 import함) -->
   <script type="module" src="../geolocation/js/ui/rb_view.js"></script>
   <script type="module" src="../geolocation/js/ui/rb_view.js"></script>
  <script type="module" src="./js/cp-sync.js"></script>
  <script type="module" src="./js/geohunt.js"></script>
  <script type="module" src="./js/ui/puppyStatsView.js"></script>

  <!-- Minimal page script (wallet-only) -->
  <script>
    (function(){
      // 일부 기존 코드가 GH_MODE를 참고할 수 있어 강제로 'wallet'로 고정
      try {
        sessionStorage.setItem('GH_MODE', 'wallet');
        localStorage.setItem('pf_mode', 'wallet');
      } catch {}

      const startBtn = document.getElementById('btnStartGame');
      const routeStart = ()=>{
        const target = './play2.html'; // 항상 Wallet 진입
        try { window.location.href = target; }
        catch { window.location.assign(target); }
        setTimeout(()=>{ try{ if (!location.href.includes(target)) location.assign(target); }catch{} }, 120);
      };
      startBtn.addEventListener('click', routeStart, { passive:false });
      startBtn.addEventListener('touchend', routeStart, { passive:true });

      // Wallet 박스는 항상 노출
      const walletBox = document.getElementById('walletBox');
      if (walletBox) walletBox.style.display = '';
      const modeBadge = document.getElementById('modeBadge');
      if (modeBadge) modeBadge.textContent = 'Mode: Wallet';
    })();
  </script>
</body>
</html>
